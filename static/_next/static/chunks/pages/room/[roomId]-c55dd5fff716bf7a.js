(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[947],{6073:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/room/[roomId]",function(){return r(7362)}])},7362:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return I}});var n=r(5893),s=r(7294),a=r(1163),o=r(5675),l=r.n(o),i=r(2088),c=r(9367);function u(e){let{name:t,setName:r,avatarUrl:a,setAvatarUrl:o,generateAvatar:u}=e,[d,m]=(0,s.useState)(!1);return(0,n.jsx)("div",{className:"mb-4",children:d?(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("input",{type:"text",value:t,onChange:e=>r(e.target.value),placeholder:"Enter your name",className:"rounded-md border border-gray-300 px-2 py-1"}),(0,n.jsx)("button",{onClick:()=>{m(!1),localStorage.setItem("username",t),o(u(t))},className:"rounded-md bg-transparent px-3 py-1 text-black",children:(0,n.jsx)(c.JMf,{})})]}):(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[a?(0,n.jsx)(l(),{src:a,alt:"avatar",className:"h-10 w-10 rounded-full",width:40,height:40}):(0,n.jsx)("span",{children:"Loading avatar..."}),(0,n.jsx)("span",{className:"font-bold",children:t||"Anonymous"}),(0,n.jsx)("button",{onClick:()=>m(!0),className:"rounded-md bg-transparent text-black",children:(0,n.jsx)(i.oTc,{size:15})})]})})}var d=r(990);function m(e){let{messages:t}=e,r=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=r.current.lastChild;e&&(d.p8.fromTo(e,{opacity:0,y:20},{opacity:1,y:0,duration:.5}),e.scrollIntoView({behavior:"smooth"}))},[t]),(0,n.jsx)("div",{ref:r,className:"mb-4 h-64 overflow-y-scroll rounded-md border border-gray-200 p-2",children:t.map((e,t)=>(0,n.jsxs)("div",{className:"mb-2 flex items-start space-x-2",children:[(0,n.jsx)(l(),{src:e.avatarUrl,alt:"avatar",className:"h-8 w-8 rounded-full",width:32,height:32}),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("strong",{className:"mb-1",children:[e.name,":"]}),e.text&&e.text.includes("![image]")?(0,n.jsx)(l(),{src:e.text.split("(")[1].split(")")[0],alt:"sent_image",className:"h-24 w-24 rounded object-cover",width:96,height:96}):e.text&&e.text.includes("![emoji]")?(0,n.jsx)(l(),{src:e.text.split("(")[1].split(")")[0],alt:"emoji",className:"h-16 w-16",width:64,height:64}):e.text&&e.text.includes("![GIF]")?(0,n.jsx)(l(),{src:e.text.split("(")[1].split(")")[0],alt:"gif",className:"max-h-48 max-w-full object-contain",width:256,height:256}):(0,n.jsx)("span",{className:"max-w-full break-words",children:e.text})]})]},t))})}var g=r(1245),f=r(3048),h=r(2594),p=r(4931),x=r(8773);function y(e){let{sendMessage:t,message:r,setMessage:a,uploadImage:o,setImageFile:l}=e,[i,c]=(0,s.useState)(!1),[u,m]=(0,s.useState)(!1),y=(0,s.useRef)(null),b=(0,s.useRef)(null),v=(0,s.useRef)(null),j=(0,s.useRef)(null),w=(0,s.useRef)(null),N=(0,s.useRef)(null),S=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=e=>{(y.current&&!y.current.contains(e.target)||b.current&&!b.current.contains(e.target))&&(d.p8.to(y.current,{opacity:0,duration:.3,onComplete:()=>c(!1)}),m(!1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let E=()=>{let e=v.current;d.p8.to(e,{height:"auto",duration:.3}),e.style.height="auto"},k=()=>{let e=v.current;e.style.height="auto";let t=e.scrollHeight;d.p8.to(e,{height:t,duration:.3})};return(0,s.useEffect)(()=>{i&&d.p8.fromTo(y.current,{opacity:0,y:10},{opacity:1,y:0,duration:.4})},[i]),(0,s.useEffect)(()=>{[j.current,N.current,S.current,w.current].forEach(e=>{d.p8.fromTo(e,{scale:1},{scale:1.1,duration:.2,ease:"power1.inOut",repeat:-1,yoyo:!0,paused:!0,onStart:()=>{e.addEventListener("mouseenter",()=>d.p8.to(e,{scale:1.1,duration:.2})),e.addEventListener("mouseleave",()=>d.p8.to(e,{scale:1,duration:.2}))}})})},[]),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)("div",{className:"mb-2 flex items-center space-x-2",children:[(0,n.jsx)("textarea",{ref:v,value:r,onChange:e=>{a(e.target.value),k()},placeholder:"Type your message",className:"flex-1 resize-none rounded-md border border-gray-300 px-2 py-1",style:{maxHeight:"150px",overflowY:"auto"},rows:1}),(0,n.jsx)("button",{ref:N,onClick:()=>{""!==r.trim()&&(t(r),a(""),E())},className:"rounded-md bg-blue-500 p-2 text-white hover:bg-blue-600",children:(0,n.jsx)(h.LbG,{size:20})}),(0,n.jsx)("input",{type:"file",id:"image-upload",style:{display:"none"},accept:"image/*",onChange:e=>{let t=e.target.files[0];t&&(l(t),o(t))}}),(0,n.jsx)("label",{ref:S,htmlFor:"image-upload",className:"cursor-pointer rounded-md bg-gray-300 p-2 hover:bg-gray-400",children:(0,n.jsx)(x.H3h,{size:20})}),(0,n.jsx)("button",{ref:j,onClick:()=>c(!i),className:"rounded-md bg-gray-300 p-2 hover:bg-gray-400",children:(0,n.jsx)(p.xGT,{size:20})}),(0,n.jsx)("button",{ref:w,onClick:()=>m(!u),className:"rounded-md bg-gray-300 p-2 hover:bg-gray-400",children:(0,n.jsx)(x.vtP,{size:20})})]}),i&&(0,n.jsx)("div",{ref:y,className:"absolute bottom-12 right-0 z-10 max-h-72 w-80 overflow-y-auto rounded-md border border-gray-300 bg-white shadow-lg",style:{maxHeight:"18rem"},children:(0,n.jsx)(g.ZP,{tenorApiKey:"AIzaSyDdCY9YWQxUHbfIke9YlLFw3XP2KJB23Bc",onGifClick:handleGifSelect})}),u&&(0,n.jsx)("div",{ref:b,className:"absolute bottom-12 left-0 z-10 max-h-72 w-80 overflow-y-auto rounded-md border border-gray-300 bg-white shadow-lg",style:{maxHeight:"18rem"},children:(0,n.jsx)(f.ZP,{onEmojiClick:e=>{let t=e.emoji,n=v.current,s=n.selectionStart,o=n.selectionEnd;a(r.substring(0,s)+t+r.substring(o)),setTimeout(()=>{n.focus(),n.setSelectionRange(s+t.length,s+t.length)},0)},emojiStyle:"native"})})]})}function b(e){let{uploadImage:t,setImageFile:r}=e;return(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("input",{type:"file",onChange:e=>r(e.target.files[0]),accept:"image/*",className:"mb-2"}),(0,n.jsx)("button",{onClick:t,className:"w-full rounded-md bg-green-500 px-4 py-2 text-white hover:bg-green-600",children:"Upload Image"})]})}var v=e=>"https://api.dicebear.com/9.x/big-smile/svg?seed=".concat(e,"&skinColor=c99c62,e2ba87,efcc9f,f5d7b1,ffe4c0");let j=(e,t,r)=>{let n=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(e)return n.current=new WebSocket("ws://".concat("localhost:8080","/")),n.current.onopen=()=>{console.log("WebSocket connection established"),n.current.send(JSON.stringify({type:"join-room",roomId:e}))},n.current.onmessage=e=>{let n=JSON.parse(e.data);"new-peer"===n.type&&r(n.peerId,a),"signal"===n.type&&t(n.signal,n.peerId,a)},()=>{n.current&&n.current.close()}},[e]);let a=(e,t)=>{n.current&&n.current.send(JSON.stringify({type:"signal",signal:e,peerId:t}))};return{sendSignal:a}};var w=r(8853);let N=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"chat",[r,n]=(0,s.useState)([]),a=(0,s.useRef)({});return{chatPeers:r,connectToNewPeer:(r,s)=>{let o=new w({initiator:!0,trickle:!1});o.on("signal",e=>{s(e,r)}),o.on("connect",()=>{console.log("Connected to peer",r),n(e=>[...e,o])}),o.on("data",r=>{try{let n=JSON.parse(r.toString());n.channel===t&&e(n)}catch(e){console.error("Error parsing data",e)}}),o.on("close",()=>{console.log("Peer ".concat(r," has been closed")),n(e=>e.filter(e=>e!==o))}),o.on("error",e=>{console.error("Error with peer",e)}),a.current[r]=o},handleSignal:(r,s,o)=>{if(!a.current[s]){let r=new w({initiator:!1,trickle:!1});a.current[s]=r,r.on("signal",e=>{o(e,s)}),r.on("connect",()=>{console.log("Connected to peer",s),n(e=>[...e,r])}),r.on("data",r=>{try{let n=JSON.parse(r.toString());n.channel===t&&e(n)}catch(e){console.error("Error parsing data",e)}})}try{a.current[s].signal(r)}catch(e){console.error("Error during signal handling:",e)}},sendMessage:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,s=JSON.stringify({...e,channel:n});r.forEach((e,t)=>{if(e.destroyed){console.warn("Peer ".concat(t," is destroyed, skipping..."));return}try{e.send(s)}catch(e){console.error("Error sending message to peer ".concat(t,":"),e)}})},sendFile:e=>{let t=JSON.stringify({type:"file",file:e});r.forEach(e=>{try{e.send(t)}catch(e){console.error("Error sending file:",e)}})}}},S=()=>"User".concat(Math.floor(1e3*Math.random())),E=()=>{let[e,t]=(0,s.useState)("");return(0,s.useEffect)(()=>{let e=localStorage.getItem("username");if(e)t(e);else{let e=S();t(e),localStorage.setItem("username",e)}},[]),[e,e=>{t(e),localStorage.setItem("username",e)}]};var k=r(3454);let C=(e,t,r)=>{let[n,a]=(0,s.useState)(null),o=async()=>{if(!n)return;let s=new FormData;s.append("image",n),s.append("key",k.env.IMGBB_API_KEY);try{let n=await fetch("https://api.imgbb.com/1/upload",{method:"POST",body:s}),a=await n.json();if(a.success){let n={name:e||"Anonymous",text:"![image](".concat(a.data.url,")"),avatarUrl:t};return r(n),n}}catch(e){console.error("Error uploading image:",e)}};return{imageFile:n,setImageFile:a,uploadImage:o}};var P=r(2004),R=r.n(P);function T(){let[e,t]=(0,s.useState)(""),[r,o]=(0,s.useState)(!1),[l,i]=(0,s.useState)(0),[c,u]=(0,s.useState)([]),[d,m]=(0,s.useState)(!1),[g,f]=(0,s.useState)(!1),[h,p]=(0,s.useState)(!1),x=(0,s.useRef)(null),{roomId:y}=(0,a.useRouter)().query,b=r=>{if("video-sync"===r.type&&!h){if(r.videoUrl!==e&&t(r.videoUrl),x.current){let e=x.current.getCurrentTime();Math.abs(r.playedSeconds-e)>1&&x.current.seekTo(r.playedSeconds,"seconds")}o(r.isPlaying)}},{chatPeers:v,connectToNewPeer:w,handleSignal:S,sendMessage:E}=N(b,"video-sync"),{sendSignal:k}=j(y,S,w),C=async e=>{try{let t=await fetch("https://sponsor.ajay.app/api/skipSegments?videoID=".concat(e)),r=await t.json();u(r)}catch(e){console.error("Error fetching SponsorBlock data:",e)}},P=e=>{let t=c.find(t=>e>=t.segment[0]&&e<t.segment[1]);t&&x.current.seekTo(t.segment[1],"seconds")},T=function(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;E({type:"video-sync",playedSeconds:t,isPlaying:r,videoUrl:n})};(0,s.useEffect)(()=>{v.forEach(e=>{e.on("data",e=>{b(JSON.parse(e))})})},[v]);let I=e=>{o(e),p(!0),g||T(l,e)};return(0,s.useEffect)(()=>{r||g||p(!1)},[r,g]),(0,n.jsxs)("div",{className:"flex w-full flex-col items-center",children:[(0,n.jsxs)("form",{onSubmit:t=>{if(t.preventDefault(),p(!0),T(0,!1,e),R().canPlay(e)){let t=new URL(e).searchParams.get("v");t&&C(t)}},className:"mb-4",children:[(0,n.jsx)("input",{type:"text",placeholder:"Enter YouTube/Vimeo/MP4 URL",value:e,onChange:e=>t(e.target.value),className:"w-96 rounded border p-2"}),(0,n.jsx)("button",{type:"submit",className:"ml-2 rounded bg-blue-500 p-2 text-white",children:"Load Video"})]}),e&&(0,n.jsx)(R(),{ref:x,url:e,playing:r,onReady:()=>{m(!0),x.current&&l>0&&x.current.seekTo(l,"seconds")},onPlay:()=>I(!0),onPause:()=>I(!1),onProgress:e=>{let{playedSeconds:t}=e;g||(i(t),P(t),T(t,r))},onSeek:e=>f(!0),onSeeked:()=>{f(!1),T(x.current.getCurrentTime(),r)},controls:!0,width:"100%",height:"100%"})]})}function I(){let{roomId:e}=(0,a.useRouter)().query,[t,r]=(0,s.useState)([]),[o,l]=(0,s.useState)(""),[i,c]=(0,s.useState)(""),[d,g]=(0,s.useState)(!0),[f,h]=E(),{chatPeers:p,connectToNewPeer:x,handleSignal:w,sendMessage:S}=N(e=>{r(t=>[...t,e]),d||"granted"!==Notification.permission||setTimeout(()=>{try{new Notification("New message from ".concat(e.name),{body:e.text,icon:e.avatarUrl})}catch(e){console.error("Error displaying notification:",e)}},100)}),{sendSignal:k}=j(e,w,x);(0,s.useEffect)(()=>{c(v(f))},[f]);let{imageFile:P,setImageFile:R,uploadImage:I}=C(f,i,S);return(0,s.useEffect)(()=>{"Notification"in window?"granted"!==Notification.permission&&Notification.requestPermission().then(e=>{"granted"===e?console.log("Notification permission granted"):console.log("Notification permission denied")}):console.log("Notifications are not supported by this browser")},[]),(0,s.useEffect)(()=>{let e=()=>{let e="visible"===document.visibilityState;g(e),console.log("Page is ".concat(e?"active":"inactive"))};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]),(0,n.jsxs)("div",{className:"flex h-screen overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex flex-1 items-center justify-center bg-gray-900",children:[" ",(0,n.jsx)(T,{})]}),(0,n.jsxs)("div",{className:"w-90 flex h-full max-h-screen flex-col space-y-4 overflow-y-auto bg-white p-4",children:[(0,n.jsxs)("h1",{className:"mb-4 text-2xl font-bold",children:["Room: ",e]}),(0,n.jsx)(u,{name:f,setName:h,avatarUrl:i,setAvatarUrl:c,generateAvatar:v}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,n.jsx)(m,{messages:t})}),(0,n.jsx)(y,{sendMessage:e=>{let t={name:f||"Anonymous",text:e,avatarUrl:i};S(t),r(e=>[...e,t]),l("")},message:o,setMessage:l}),(0,n.jsx)(b,{uploadImage:I,setImageFile:R})]})]})}},2361:function(){},4616:function(){}},function(e){e.O(0,[802,970,838,130,365,594,307,990,983,888,774,179],function(){return e(e.s=6073)}),_N_E=e.O()}]);