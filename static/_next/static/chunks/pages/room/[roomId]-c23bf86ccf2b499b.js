(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[947],{6073:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/room/[roomId]",function(){return s(4892)}])},4892:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var a=s(5893),n=s(7294),o=s(1163),r=s(434),i=s(1759),l=s(5675),c=s.n(l);function d(e){let{name:t,setName:s,avatarUrl:o,setAvatarUrl:r,generateAvatar:i}=e,[l,d]=(0,n.useState)(!1);return(0,a.jsx)("div",{className:"mb-4",children:l?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"text",value:t,onChange:e=>s(e.target.value),placeholder:"Enter your name",className:"rounded-md border border-gray-300 px-2 py-1"}),(0,a.jsx)("button",{onClick:()=>{d(!1),localStorage.setItem("username",t),r(i(t))},className:"rounded-md bg-green-500 px-3 py-1 text-white",children:"Save"})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(c(),{src:o,alt:"avatar",className:"h-10 w-10 rounded-full",width:40,height:40}),(0,a.jsx)("span",{className:"font-bold",children:t||"Anonymous"}),(0,a.jsx)("button",{onClick:()=>d(!0),className:"rounded-md bg-blue-500 px-3 py-1 text-white",children:"Edit Name"})]})})}function u(e){let{messages:t}=e;return(0,a.jsx)("div",{className:"mb-4 h-64 overflow-y-scroll rounded-md border border-gray-200 p-2",children:t.map((e,t)=>(0,a.jsxs)("div",{className:"mb-2 flex items-center space-x-2",children:[(0,a.jsx)(c(),{src:e.avatarUrl,alt:"avatar",className:"h-8 w-8 rounded-full",width:32,height:32}),(0,a.jsxs)("strong",{children:[e.name,":"]}),e.text.includes("![image]")?(0,a.jsx)(c(),{src:e.text.split("(")[1].split(")")[0],alt:"sent_image",className:"h-24 w-24 rounded object-cover",width:96,height:96}):e.text.includes("![emoji]")?(0,a.jsx)(c(),{src:e.text.split("(")[1].split(")")[0],alt:"emoji",className:"h-16 w-16",width:64,height:64}):e.text.includes("![GIF]")?(0,a.jsx)(c(),{src:e.text.split("(")[1].split(")")[0],alt:"gif",className:"max-h-48 max-w-full object-contain",width:256,height:256}):(0,a.jsx)("span",{children:e.text})]},t))})}var m=s(1245);function h(e){let{sendMessage:t,message:s,setMessage:o}=e,[r,i]=(0,n.useState)(!1);return(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{type:"text",value:s,onChange:e=>o(e.target.value),placeholder:"Type your message",className:"mb-2 w-full rounded-md border border-gray-300 px-2 py-1"}),(0,a.jsx)("button",{onClick:()=>t(s),className:"w-full rounded-md bg-blue-500 px-4 py-2 text-white hover:bg-blue-600",children:"Send"}),(0,a.jsx)("button",{onClick:()=>i(!r),className:"mt-2 w-full rounded-md bg-gray-300 px-4 py-2 hover:bg-gray-400",children:r?"Close GIF Picker":"Open GIF Picker"}),r&&(0,a.jsx)(m.ZP,{tenorApiKey:"AIzaSyDdCY9YWQxUHbfIke9YlLFw3XP2KJB23Bc",onGifClick:e=>{t("![GIF](".concat(e.url,")")),i(!1)}})]})}function p(e){let{uploadImage:t,setImageFile:s}=e;return(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("input",{type:"file",onChange:e=>s(e.target.files[0]),accept:"image/*",className:"mb-2"}),(0,a.jsx)("button",{onClick:t,className:"w-full rounded-md bg-green-500 px-4 py-2 text-white hover:bg-green-600",children:"Upload Image"})]})}var x=e=>"https://api.dicebear.com/9.x/big-smile/svg?seed=".concat(e,"&skinColor=c99c62,e2ba87,efcc9f,f5d7b1,ffe4c0"),f=s(3454);function g(){let{roomId:e}=(0,o.useRouter)().query,[t,s]=(0,n.useState)(null),[l,c]=(0,n.useState)([]),[m,g]=(0,n.useState)([]),[b,v]=(0,n.useState)(""),[j,y]=(0,n.useState)(""),[N,w]=(0,n.useState)(""),[S,E]=(0,n.useState)(null),[I,k]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("username");if(e)y(e),w(x(e));else{let e=(0,i.XR)();y(e),w(x(e)),localStorage.setItem("username",e)}},[]),(0,n.useEffect)(()=>{let t=new r.ZP(void 0,{host:"0.peerjs.com",port:443,path:"/",secure:!0});return t.on("open",a=>{s(t),fetch("/api/peers/".concat(e)).then(e=>e.json()).then(e=>{let{peers:s}=e;s.forEach(e=>{if(e!==a){let s=t.connect(e);s.on("open",()=>{c(e=>[...e,s]),s.on("data",C)})}})}),fetch("/api/peers/".concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({peerId:a})})}),t.on("connection",e=>{c(t=>[...t,e]),e.on("data",C)}),()=>{t.destroy()}},[e]);let C=e=>{g(t=>[...t,e]),I||"granted"!==Notification.permission||setTimeout(()=>{try{new Notification("Новое сообщение от ".concat(e.name),{body:e.text,icon:e.avatarUrl})}catch(e){console.error("Ошибка при создании уведомления:",e)}},100)},_=async()=>{if(!S)return;let e=new FormData;e.append("image",S),e.append("key",f.env.IMGBB_API_KEY);try{let t=await fetch("https://api.imgbb.com/1/upload",{method:"POST",body:e}),s=await t.json();if(s.success){let e={name:j||"Anonymous",text:"![image](".concat(s.data.url,")"),avatarUrl:N};l.forEach(t=>{t.send(e)}),g(t=>[...t,e])}}catch(e){console.error("Error uploading image:",e)}};return(0,n.useEffect)(()=>{"Notification"in window?"granted"!==Notification.permission&&Notification.requestPermission().then(e=>{"granted"===e?console.log("Разрешение на уведомления получено"):console.log("Разрешение на уведомления отклонено")}):console.log("Уведомления не поддерживаются в этом браузере")},[]),(0,n.useEffect)(()=>{let e=()=>{let e="visible"===document.visibilityState;k(e),console.log("Page is ".concat(e?"active":"inactive"))};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]),(0,a.jsxs)("div",{className:"flex h-screen flex-col items-center justify-center p-4",children:[(0,a.jsxs)("h1",{className:"mb-4 text-2xl font-bold",children:["Room: ",e]}),(0,a.jsx)(d,{name:j,setName:y,avatarUrl:N,setAvatarUrl:w,generateAvatar:x}),(0,a.jsx)(u,{messages:m}),(0,a.jsx)(h,{sendMessage:e=>{let t={name:j||"Anonymous",text:e,avatarUrl:N};l.forEach(e=>{e.send(t)}),g(e=>[...e,t]),v("")},message:b,setMessage:v}),(0,a.jsx)(p,{uploadImage:_,setImageFile:E})]})}}},function(e){e.O(0,[282,714,773,888,774,179],function(){return e(e.s=6073)}),_N_E=e.O()}]);