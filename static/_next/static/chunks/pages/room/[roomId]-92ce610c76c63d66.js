(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[947],{6073:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/room/[roomId]",function(){return a(9277)}])},9277:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=a(5893),n=a(7294),r=a(1163),o=a(434),l=a(1759),c=a(5675),i=a.n(c);function d(e){let{name:t,setName:a,avatarUrl:r,setAvatarUrl:o,generateAvatar:l}=e,[c,d]=(0,n.useState)(!1);return(0,s.jsx)("div",{className:"mb-4",children:c?(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"text",value:t,onChange:e=>a(e.target.value),placeholder:"Enter your name",className:"rounded-md border border-gray-300 px-2 py-1"}),(0,s.jsx)("button",{onClick:()=>{d(!1),localStorage.setItem("username",t),o(l(t))},className:"rounded-md bg-green-500 px-3 py-1 text-white",children:"Save"})]}):(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(i(),{src:r,alt:"avatar",className:"h-10 w-10 rounded-full",width:40,height:40}),(0,s.jsx)("span",{className:"font-bold",children:t||"Anonymous"}),(0,s.jsx)("button",{onClick:()=>d(!0),className:"rounded-md bg-blue-500 px-3 py-1 text-white",children:"Edit Name"})]})})}function u(e){let{messages:t}=e;return(0,s.jsx)("div",{className:"mb-4 h-64 overflow-y-scroll rounded-md border border-gray-200 p-2",children:t.map((e,t)=>(0,s.jsxs)("div",{className:"mb-2 flex items-center space-x-2",children:[(0,s.jsx)("img",{src:e.avatarUrl,alt:"avatar",className:"h-8 w-8 rounded-full"}),(0,s.jsxs)("strong",{children:[e.name,":"]}),e.text.includes("![image]")?(0,s.jsx)("img",{src:e.text.split("(")[1].split(")")[0],alt:"sent_image",className:"h-24 w-24 rounded object-cover"}):e.text.includes("![emoji]")?(0,s.jsx)("img",{src:e.text.split("(")[1].split(")")[0],alt:"emoji",className:"h-16 w-16"}):e.text]},t))})}function m(e){let{sendMessage:t,message:a,setMessage:n}=e;return(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{type:"text",value:a,onChange:e=>n(e.target.value),placeholder:"Type your message",className:"mb-2 w-full rounded-md border border-gray-300 px-2 py-1"}),(0,s.jsx)("button",{onClick:t,className:"w-full rounded-md bg-blue-500 px-4 py-2 text-white hover:bg-blue-600",children:"Send"})]})}function p(e){let{uploadImage:t,setImageFile:a}=e;return(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("input",{type:"file",onChange:e=>a(e.target.files[0]),accept:"image/*",className:"mb-2"}),(0,s.jsx)("button",{onClick:t,className:"w-full rounded-md bg-green-500 px-4 py-2 text-white hover:bg-green-600",children:"Upload Image"})]})}var x=a(3454);function h(){let{roomId:e}=(0,r.useRouter)().query,[t,a]=(0,n.useState)(null),[c,i]=(0,n.useState)([]),[h,f]=(0,n.useState)([]),[g,b]=(0,n.useState)(""),[j,N]=(0,n.useState)(""),[y,v]=(0,n.useState)(""),[w,S]=(0,n.useState)(null),[_,E]=(0,n.useState)(!0),C=e=>"https://api.dicebear.com/9.x/big-smile/svg?seed=".concat(e,"&skinColor=c99c62,e2ba87,efcc9f,f5d7b1,ffe4c0");(0,n.useEffect)(()=>{let e=localStorage.getItem("username");if(e)N(e),v(C(e));else{let e=(0,l.XR)();N(e),v(C(e)),localStorage.setItem("username",e)}},[]),(0,n.useEffect)(()=>{let t=new o.ZP(void 0,{host:"0.peerjs.com",port:443,path:"/",secure:!0});return t.on("open",s=>{a(t),fetch("/api/peers/".concat(e)).then(e=>e.json()).then(e=>{let{peers:a}=e;a.forEach(e=>{if(e!==s){let a=t.connect(e);a.on("open",()=>{i(e=>[...e,a]),a.on("data",k)})}})}),fetch("/api/peers/".concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({peerId:s})})}),t.on("connection",e=>{i(t=>[...t,e]),e.on("data",k)}),()=>{t.destroy()}},[e]);let k=e=>{f(t=>[...t,e]),_||"granted"!==Notification.permission||new Notification("New message from ".concat(e.name),{body:e.text})},I=async()=>{if(!w)return;let e=new FormData;e.append("image",w),e.append("key",x.env.IMGBB_API_KEY);try{let t=await fetch("https://api.imgbb.com/1/upload",{method:"POST",body:e}),a=await t.json();if(a.success){let e={name:j||"Anonymous",text:"![image](".concat(a.data.url,")"),avatarUrl:y};c.forEach(t=>{t.send(e)}),f(t=>[...t,e])}}catch(e){console.error("Error uploading image:",e)}};return(0,s.jsxs)("div",{className:"flex h-screen flex-col items-center justify-center p-4",children:[(0,s.jsxs)("h1",{className:"mb-4 text-2xl font-bold",children:["Room: ",e]}),(0,s.jsx)(d,{name:j,setName:N,avatarUrl:y,setAvatarUrl:v,generateAvatar:C}),(0,s.jsx)(u,{messages:h}),(0,s.jsx)(m,{sendMessage:()=>{let e={name:j||"Anonymous",text:g,avatarUrl:y};c.forEach(t=>{t.send(e)}),f(t=>[...t,e]),b("")},message:g,setMessage:b}),(0,s.jsx)(p,{uploadImage:I,setImageFile:S})]})}}},function(e){e.O(0,[282,714,358,888,774,179],function(){return e(e.s=6073)}),_N_E=e.O()}]);