(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{8916:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return n(4520)}])},4520:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n(5893),s=n(7294);function c(){let[e,t]=(0,s.useState)([]),[n,c]=(0,s.useState)(""),[a,o]=(0,s.useState)(!1),l=(0,s.useRef)(null),u=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=new EventSource("/api/connect");return e.onmessage=function(e){let n=JSON.parse(e.data);t(e=>[...e,n])},()=>e.close()},[]),(0,s.useEffect)(()=>(l.current=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),u.current=l.current.createDataChannel("chat"),u.current.onmessage=e=>{t(t=>[...t,{from:"remote",text:e.data}])},u.current.onopen=()=>{o(!0)},u.current.onclose=()=>{o(!1)},l.current.onicecandidate=e=>{e.candidate&&fetch("/api/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e.candidate})})},l.current.createOffer().then(e=>{l.current.setLocalDescription(e),fetch("/api/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e})})}),()=>l.current.close()),[]);let i=async()=>{a?(u.current.send(n),t(e=>[...e,{from:"me",text:n}]),c("")):console.log("Канал ещё не открыт для отправки сообщений.")};return(0,r.jsx)("div",{className:"flex min-h-screen flex-col items-center justify-center bg-gray-100",children:(0,r.jsxs)("div",{className:"w-full max-w-md rounded-lg bg-white p-4 shadow-lg",children:[(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("h1",{className:"text-center text-2xl font-bold",children:"WebRTC Chat"})}),(0,r.jsx)("div",{className:"mb-4 h-64 overflow-y-auto rounded bg-gray-50 p-2",children:e.map((e,t)=>(0,r.jsx)("div",{className:"text-sm ".concat("me"===e.from?"text-right":"text-left"),children:(0,r.jsxs)("span",{className:"".concat("me"===e.from?"text-blue-500":"text-gray-500"),children:[e.from,": ",e.text]})},t))}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"text",value:n,onChange:e=>c(e.target.value),className:"mr-2 w-full rounded border-gray-300 p-2",placeholder:"Type your message..."}),(0,r.jsx)("button",{onClick:i,className:"rounded bg-blue-500 px-4 py-2 text-white",children:"Send"})]})]})})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=8916)}),_N_E=e.O()}]);